<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home advantage in the Bradley-Terry and in the Davidson model • bpcs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Home advantage in the Bradley-Terry and in the Davidson model">
<meta property="og:description" content="bpcs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bpcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_get_started.html">Getting Started with the bpcs package</a>
    </li>
    <li>
      <a href="../articles/b_ties_and_home_advantage.html">Home advantage in the Bradley-Terry and in the Davidson model</a>
    </li>
    <li>
      <a href="../articles/c_bt_random_effects.html">Random effects in the Bradley-Terry model</a>
    </li>
    <li>
      <a href="../articles/d_paper.html">d_paper</a>
    </li>
    <li>
      <a href="../articles/e_contributing.html">Contributing guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidissamattos/bpcs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="b_ties_and_home_advantage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Home advantage in the Bradley-Terry and in the Davidson model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidissamattos/bpcs/blob/master/vignettes/b_ties_and_home_advantage.Rmd"><code>vignettes/b_ties_and_home_advantage.Rmd</code></a></small>
      <div class="hidden name"><code>b_ties_and_home_advantage.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/davidissamattos/bpcs">bpcs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="co">#Stan should use parallel cores</span>
<span class="co"># options(mc.cores = parallel::detectCores()) #use multiple cores</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#CRAN works only with max 2 cores</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we will go over a sport dataset that consists of the games from the main Brazilian football league from 2017-2019. In this example, we will create a ranking system for the teams based on the Bradley-Terry model. Then we will expand this to include ties, home-advantage effects and ties with home-advantage. Note that in this example we give equal weights to a game regardless of the date, i.e. more recent games have the same impact as older games.</p>
<p>The data can be accessed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"brasil_soccer_league"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">brasil_soccer_league</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Time
</th>
<th style="text-align:left;">
WeekDay
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
<th style="text-align:left;">
Stadium
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
19:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Arena Corinthians
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:left;">
Vitória
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Ressacada
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fonte Nova
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mineirão
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
11:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Fluminense
</td>
<td style="text-align:left;">
Santos
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Let’s analyze only the data from 2019 and remove a few columns that are not relevant for this example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">brasil_soccer_league</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">Date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">HomeTeam</span>, <span class="va">VisitorTeam</span>, <span class="va">ScoreHomeTeam</span>, <span class="va">ScoreVisitorTeam</span>, <span class="va">Round</span><span class="op">)</span> </code></pre></div>
<p>Now we have a smaller dataset (380 rows with 5 variables)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:left;">
Internacional
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:left;">
Botafogo-rj
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:left;">
Vasco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="fitting-a-bradley-terry-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-a-bradley-terry-model" class="anchor"></a>Fitting a Bradley-Terry model</h1>
<p>Let’s start fitting a simple Bradley-Terry model and handle ties randomly</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span>
  <span class="va">d</span>,
  player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>,
  player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>,
  player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
  player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
  model_type <span class="op">=</span> <span class="st">'bt'</span>,
  solve_ties <span class="op">=</span> <span class="st">'random'</span>,
  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span>,
  <span class="co"># making a more informative prior to improve convergence</span>
  iter <span class="op">=</span> <span class="fl">3000</span>
<span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<div id="simple-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-diagnostics" class="anchor"></a>Simple diagnostics</h2>
<p>Looking at the Rhat and the n_eff:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.113      -2.260        0.026    970.165   1.001</span>
<span class="co">#&gt; lambda[Internacional]    -0.151      -1.240        0.991    900.307   1.001</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.491      -1.664        0.572    895.428   1.002</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.609      -1.710        0.481    924.378   1.001</span>
<span class="co">#&gt; lambda[Vasco]             0.071      -1.042        1.140    874.326   1.001</span>
<span class="co">#&gt; lambda[Corinthians]       0.074      -1.055        1.147    928.014   1.001</span>
<span class="co">#&gt; lambda[CSA]              -0.845      -1.965        0.278    917.876   1.001</span>
<span class="co">#&gt; lambda[Goiás]             0.072      -1.033        1.169    895.352   1.001</span>
<span class="co">#&gt; lambda[Fortaleza]        -0.038      -1.093        1.097    931.318   1.001</span>
<span class="co">#&gt; lambda[Santos]            1.041      -0.114        2.210    963.368   1.001</span>
<span class="co">#&gt; lambda[Grêmio]            0.414      -0.718        1.521    910.262   1.002</span>
<span class="co">#&gt; lambda[Palmeiras]         0.653      -0.417        1.804    904.653   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.150      -1.258        0.943    891.439   1.001</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.851      -1.958        0.287    957.912   1.001</span>
<span class="co">#&gt; lambda[Ceará]            -0.728      -1.847        0.411    921.654   1.002</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.415      -0.738        1.502    922.267   1.001</span>
<span class="co">#&gt; lambda[Flamengo]          1.669       0.453        2.881   1054.696   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.417      -0.712        1.509    888.138   1.002</span>
<span class="co">#&gt; lambda[Bahia]             0.187      -0.934        1.297    904.879   1.001</span>
<span class="co">#&gt; lambda[Fluminense]       -0.606      -1.694        0.509    933.399   1.001</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span></code></pre></div>
<p>Both look fine for all teams.</p>
<p>Looking at the traceplots for the first 4 teams only (we can look at the others or launch the shinystan app)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanfit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_stanfit.html">get_stanfit</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">posterior</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html">extract</a></span><span class="op">(</span><span class="va">stanfit</span>,inc_warmup<span class="op">=</span><span class="cn">T</span>,permuted<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">posterior</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda[1]"</span>,<span class="st">"lambda[2]"</span>,<span class="st">"lambda[3]"</span>,<span class="st">"lambda[4]"</span><span class="op">)</span>, n_warmup<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p><img src="b_ties_and_home_advantage_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>They sound ok so there is no reason why we should not trust our data</p>
</div>
<div id="ranking-with-the-bt-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-with-the-bt-model" class="anchor"></a>Ranking with the bt model</h2>
<p>Let’s get the rank with the simple <code>bt</code> model</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
19
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fitting-the-davidson-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-davidson-model" class="anchor"></a>Fitting the Davidson model</h1>
<p>Now lets investigate how ties impact our model</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          model_type <span class="op">=</span> <span class="st">'davidson'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher       n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ----------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.920      -3.256       -0.592    2172.208   1.000</span>
<span class="co">#&gt; lambda[Internacional]     0.149      -1.078        1.433    1646.996   1.001</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.696      -1.902        0.576    1621.875   1.001</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.586      -1.859        0.653    1715.118   1.001</span>
<span class="co">#&gt; lambda[Vasco]            -0.075      -1.338        1.134    1610.693   1.001</span>
<span class="co">#&gt; lambda[Corinthians]       0.296      -0.900        1.525    1562.756   1.001</span>
<span class="co">#&gt; lambda[CSA]              -1.112      -2.302        0.238    1974.635   1.001</span>
<span class="co">#&gt; lambda[Goiás]            -0.065      -1.339        1.175    1751.565   1.001</span>
<span class="co">#&gt; lambda[Fortaleza]         0.126      -1.145        1.346    1726.817   1.001</span>
<span class="co">#&gt; lambda[Santos]            1.066      -0.183        2.339    1816.502   1.001</span>
<span class="co">#&gt; lambda[Grêmio]            0.620      -0.626        1.898    1799.348   1.001</span>
<span class="co">#&gt; lambda[Palmeiras]         1.233      -0.071        2.476    1777.669   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.054      -1.244        1.238    1639.124   1.002</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.993      -2.331        0.248    1859.515   1.001</span>
<span class="co">#&gt; lambda[Ceará]            -0.731      -1.959        0.549    1696.472   1.001</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.707      -0.556        1.965    1728.160   1.001</span>
<span class="co">#&gt; lambda[Flamengo]          2.036       0.682        3.387    1958.084   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.612      -0.697        1.812    1723.159   1.001</span>
<span class="co">#&gt; lambda[Bahia]            -0.142      -1.408        1.061    1590.654   1.001</span>
<span class="co">#&gt; lambda[Fluminense]       -0.390      -1.620        0.885    1835.091   1.000</span>
<span class="co">#&gt; nu                        0.386       0.152        0.623   10426.053   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span></code></pre></div>
<div id="ranking" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with ties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that when we consider ties the rank has changed a bit and the difference between the teams reduce (we can see from both the parameter table as well as many equal median ranks between the teams).</p>
</div>
</div>
<div id="bradley-terry-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#bradley-terry-with-order-effect-home-advantage" class="anchor"></a>Bradley-Terry with order effect (home advantage)</h1>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d_home</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>home_player1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'btordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'random'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.326      -2.510       -0.219   1020.505   1.001</span>
<span class="co">#&gt; lambda[Internacional]     0.331      -0.730        1.497    970.051   1.002</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.522      -1.652        0.556    986.734   1.002</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.524      -1.644        0.532    926.555   1.002</span>
<span class="co">#&gt; lambda[Vasco]            -0.277      -1.428        0.777    947.911   1.002</span>
<span class="co">#&gt; lambda[Corinthians]       0.324      -0.798        1.401    902.494   1.001</span>
<span class="co">#&gt; lambda[CSA]              -0.909      -2.109        0.152    958.999   1.002</span>
<span class="co">#&gt; lambda[Goiás]            -0.150      -1.238        0.921    919.000   1.002</span>
<span class="co">#&gt; lambda[Fortaleza]        -0.034      -1.163        1.064    944.948   1.002</span>
<span class="co">#&gt; lambda[Santos]            1.274       0.077        2.440   1043.836   1.002</span>
<span class="co">#&gt; lambda[Grêmio]            0.206      -0.882        1.324    995.272   1.002</span>
<span class="co">#&gt; lambda[Palmeiras]         1.276       0.095        2.420   1067.543   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.400      -1.544        0.649    948.094   1.002</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.525      -1.629        0.620    968.477   1.002</span>
<span class="co">#&gt; lambda[Ceará]            -0.778      -1.865        0.328    961.678   1.002</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.080      -1.053        1.152    903.569   1.002</span>
<span class="co">#&gt; lambda[Flamengo]          1.605       0.436        2.855   1169.096   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.448      -0.674        1.530    950.941   1.002</span>
<span class="co">#&gt; lambda[Bahia]            -0.156      -1.244        0.958    943.567   1.001</span>
<span class="co">#&gt; lambda[Fluminense]       -0.404      -1.502        0.693    921.582   1.002</span>
<span class="co">#&gt; gm                       -0.597      -0.826       -0.355   8247.521   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see that the gm parameter is negative indicating that playing home indeed provide an advantage to the matches.</p>
<div id="ranking-1" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-1" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that the players ranking has changed a bit from the BT and the Davidson model when we compensate for the home advantage</p>
</div>
</div>
<div id="davidson-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#davidson-with-order-effect-home-advantage" class="anchor"></a>Davidson with order effect (home advantage)</h1>
<p>Now let’s fit our last model. The Davidson model with order effect. Here we take into account the ties and the home advantage effect</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'davidsonordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher       n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ----------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -3.002      -4.707       -1.367    5003.654   1.000</span>
<span class="co">#&gt; lambda[Internacional]     0.021      -1.387        1.541    3338.425   1.000</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.996      -2.471        0.522    3492.867   1.000</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.808      -2.358        0.605    3538.423   1.000</span>
<span class="co">#&gt; lambda[Vasco]            -0.024      -1.495        1.439    3533.836   1.001</span>
<span class="co">#&gt; lambda[Corinthians]       0.393      -1.081        1.884    3423.587   1.000</span>
<span class="co">#&gt; lambda[CSA]              -1.625      -3.074       -0.032    3439.163   1.000</span>
<span class="co">#&gt; lambda[Goiás]            -0.021      -1.544        1.390    3689.622   1.001</span>
<span class="co">#&gt; lambda[Fortaleza]         0.373      -1.057        1.912    3332.320   1.000</span>
<span class="co">#&gt; lambda[Santos]            1.417      -0.128        2.897    3362.850   1.000</span>
<span class="co">#&gt; lambda[Grêmio]            0.968      -0.577        2.432    3672.950   1.000</span>
<span class="co">#&gt; lambda[Palmeiras]         1.824       0.336        3.409    3917.511   1.000</span>
<span class="co">#&gt; lambda[Atlético-MG]       0.162      -1.323        1.618    3707.297   1.000</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.234      -2.674        0.282    3500.516   1.000</span>
<span class="co">#&gt; lambda[Ceará]            -1.184      -2.669        0.346    3346.835   1.000</span>
<span class="co">#&gt; lambda[Athlético-PR]      1.164      -0.315        2.656    3461.489   1.000</span>
<span class="co">#&gt; lambda[Flamengo]          2.804       1.106        4.361    4730.777   1.000</span>
<span class="co">#&gt; lambda[São Paulo]         0.789      -0.698        2.235    3575.463   1.000</span>
<span class="co">#&gt; lambda[Bahia]            -0.379      -1.784        1.063    3610.279   1.000</span>
<span class="co">#&gt; lambda[Fluminense]       -0.762      -2.297        0.637    3263.113   1.000</span>
<span class="co">#&gt; nu                        0.085      -0.119        0.301   15791.834   1.000</span>
<span class="co">#&gt; gm                       -3.892      -4.819       -2.960   12483.812   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see again that the home advantage gm parameter was negative, indicating that there is a home advantage effect.</p>
<div id="ranking-2" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-2" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage and ties:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="comparing-the-models-with-waic" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-the-models-with-waic" class="anchor"></a>Comparing the models with WAIC</h1>
<p>Let’s see now using an information criteria (the WAIC) which model fits the data better.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">m2_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="va">m3_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="va">m4_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>We can look at each waic:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -249.3  8.1</span>
<span class="co">#&gt; p_waic        19.7  0.8</span>
<span class="co">#&gt; waic         498.5 16.1</span>
<span class="va">m2_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -332.2 10.4</span>
<span class="co">#&gt; p_waic        19.5  1.1</span>
<span class="co">#&gt; waic         664.5 20.7</span>
<span class="va">m3_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -236.6  9.1</span>
<span class="co">#&gt; p_waic        20.5  1.0</span>
<span class="co">#&gt; waic         473.2 18.2</span>
<span class="va">m4_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -382.3 18.6</span>
<span class="co">#&gt; p_waic        35.5  1.8</span>
<span class="co">#&gt; waic         764.7 37.2</span></code></pre></div>
<p>Or can also use the loo::compare function to see which performs better.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span><span class="op">(</span><span class="va">m1_waic</span>,<span class="va">m2_waic</span>, <span class="va">m3_waic</span>, <span class="va">m4_waic</span><span class="op">)</span>
<span class="co">#&gt;        elpd_diff se_diff</span>
<span class="co">#&gt; model3    0.0       0.0 </span>
<span class="co">#&gt; model1  -12.7       8.7 </span>
<span class="co">#&gt; model2  -95.6      12.2 </span>
<span class="co">#&gt; model4 -145.7      14.8</span></code></pre></div>
<p>We can see here that the best performing model was the Davidson model (lowest WAIC)</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final remarks</h1>
<p>In this vignette, we looked at 4 different models. However, we have not explored the impact of different priors in the model performance. For example, we might have improved the home advantage models by setting more informative priors to restrict the parameter estimate (which in model 4 was quite large).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Issa Mattos, Erika Martins Silva Ramos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
