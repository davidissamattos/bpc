<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home advantage in the Bradley-Terry and in the Davidson model • bpcs</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Home advantage in the Bradley-Terry and in the Davidson model">
<meta property="og:description" content="bpcs">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bpcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_get_started.html">Getting Started with the bpcs package</a>
    </li>
    <li>
      <a href="../articles/b_ties_and_home_advantage.html">Home advantage in the Bradley-Terry and in the Davidson model</a>
    </li>
    <li>
      <a href="../articles/c_bt_random_effects.html">Random effects in the Bradley-Terry model</a>
    </li>
    <li>
      <a href="../articles/d_paper.html">d_paper</a>
    </li>
    <li>
      <a href="../articles/e_contributing.html">Contributing guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidissamattos/bpcs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="b_ties_and_home_advantage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Home advantage in the Bradley-Terry and in the Davidson model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidissamattos/bpcs/blob/master/vignettes/b_ties_and_home_advantage.Rmd"><code>vignettes/b_ties_and_home_advantage.Rmd</code></a></small>
      <div class="hidden name"><code>b_ties_and_home_advantage.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/davidissamattos/bpcs">bpcs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="co">#Stan should use parallel cores</span>
<span class="co"># options(mc.cores = parallel::detectCores()) #use multiple cores</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#CRAN works only with max 2 cores</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we will go over a sport dataset that consists of the games from the main Brazilian football league from 2017-2019. In this example, we will create a ranking system for the teams based on the Bradley-Terry model. Then we will expand this to include ties, home-advantage effects and ties with home-advantage. Note that in this example we give equal weights to a game regardless of the date, i.e. more recent games have the same impact as older games.</p>
<p>The data can be accessed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"brasil_soccer_league"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">brasil_soccer_league</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Time
</th>
<th style="text-align:left;">
WeekDay
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
<th style="text-align:left;">
Stadium
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
19:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Arena Corinthians
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:left;">
Vitória
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Ressacada
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fonte Nova
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mineirão
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
11:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Fluminense
</td>
<td style="text-align:left;">
Santos
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Let’s analyze only the data from 2019 and remove a few columns that are not relevant for this example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">brasil_soccer_league</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">Date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">HomeTeam</span>, <span class="va">VisitorTeam</span>, <span class="va">ScoreHomeTeam</span>, <span class="va">ScoreVisitorTeam</span>, <span class="va">Round</span><span class="op">)</span> </code></pre></div>
<p>Now we have a smaller dataset (380 rows with 5 variables)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:left;">
Internacional
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:left;">
Botafogo-rj
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:left;">
Vasco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="fitting-a-bradley-terry-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-a-bradley-terry-model" class="anchor"></a>Fitting a Bradley-Terry model</h1>
<p>Let’s start fitting a simple Bradley-Terry model and handle ties randomly</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span>
  <span class="va">d</span>,
  player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>,
  player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>,
  player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
  player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
  model_type <span class="op">=</span> <span class="st">'bt'</span>,
  solve_ties <span class="op">=</span> <span class="st">'random'</span>,
  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span>,
  <span class="co"># making a more informative prior to improve convergence</span>
  iter <span class="op">=</span> <span class="fl">3000</span>
<span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<div id="simple-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-diagnostics" class="anchor"></a>Simple diagnostics</h2>
<p>Looking at the Rhat and the n_eff:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher     n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  --------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.207      -2.383       -0.068   842.805   1.002</span>
<span class="co">#&gt; lambda[Internacional]     0.113      -1.003        1.216   734.870   1.002</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.565      -1.752        0.471   768.792   1.002</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.452      -1.535        0.703   765.543   1.002</span>
<span class="co">#&gt; lambda[Vasco]             0.109      -1.055        1.210   753.350   1.002</span>
<span class="co">#&gt; lambda[Corinthians]       0.219      -0.912        1.297   760.711   1.002</span>
<span class="co">#&gt; lambda[CSA]              -0.685      -1.808        0.452   750.508   1.002</span>
<span class="co">#&gt; lambda[Goiás]            -0.114      -1.234        0.971   732.287   1.003</span>
<span class="co">#&gt; lambda[Fortaleza]         0.332      -0.772        1.489   784.460   1.002</span>
<span class="co">#&gt; lambda[Santos]            0.940      -0.178        2.117   793.013   1.002</span>
<span class="co">#&gt; lambda[Grêmio]            0.334      -0.795        1.440   763.113   1.002</span>
<span class="co">#&gt; lambda[Palmeiras]         0.807      -0.319        1.965   766.399   1.002</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.115      -1.232        1.003   749.270   1.002</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.688      -1.770        0.430   770.380   1.002</span>
<span class="co">#&gt; lambda[Ceará]            -0.564      -1.718        0.549   733.361   1.002</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.220      -0.838        1.396   741.428   1.002</span>
<span class="co">#&gt; lambda[Flamengo]          1.701       0.509        2.920   913.606   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.218      -0.913        1.315   728.614   1.002</span>
<span class="co">#&gt; lambda[Bahia]             0.225      -0.904        1.346   755.427   1.002</span>
<span class="co">#&gt; lambda[Fluminense]       -0.689      -1.799        0.447   747.315   1.002</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span></code></pre></div>
<p>Both look fine for all teams.</p>
<p>Looking at the traceplots for the first 4 teams only (we can look at the others or launch the shinystan app)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanfit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_stanfit.html">get_stanfit</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">posterior</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html">extract</a></span><span class="op">(</span><span class="va">stanfit</span>,inc_warmup<span class="op">=</span><span class="cn">T</span>,permuted<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">posterior</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda[1]"</span>,<span class="st">"lambda[2]"</span>,<span class="st">"lambda[3]"</span>,<span class="st">"lambda[4]"</span><span class="op">)</span>, n_warmup<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p><img src="b_ties_and_home_advantage_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>They sound ok so there is no reason why we should not trust our data</p>
</div>
<div id="ranking-with-the-bt-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-with-the-bt-model" class="anchor"></a>Ranking with the bt model</h2>
<p>Let’s get the rank with the simple <code>bt</code> model</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fitting-the-davidson-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-davidson-model" class="anchor"></a>Fitting the Davidson model</h1>
<p>Now lets investigate how ties impact our model</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          model_type <span class="op">=</span> <span class="st">'davidson'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.952      -3.375       -0.706   1832.830   1.001</span>
<span class="co">#&gt; lambda[Internacional]     0.123      -1.031        1.335   1507.011   1.002</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.718      -2.003        0.470   1639.776   1.001</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.628      -1.829        0.649   1660.336   1.001</span>
<span class="co">#&gt; lambda[Vasco]            -0.110      -1.283        1.121   1655.643   1.001</span>
<span class="co">#&gt; lambda[Corinthians]       0.271      -0.942        1.514   1496.570   1.001</span>
<span class="co">#&gt; lambda[CSA]              -1.143      -2.380        0.127   1718.824   1.001</span>
<span class="co">#&gt; lambda[Goiás]            -0.105      -1.367        1.113   1615.791   1.001</span>
<span class="co">#&gt; lambda[Fortaleza]         0.101      -1.139        1.289   1618.894   1.001</span>
<span class="co">#&gt; lambda[Santos]            1.040      -0.189        2.301   1657.084   1.001</span>
<span class="co">#&gt; lambda[Grêmio]            0.594      -0.628        1.853   1752.150   1.001</span>
<span class="co">#&gt; lambda[Palmeiras]         1.206      -0.086        2.424   1714.814   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.096      -1.295        1.156   1631.722   1.001</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.019      -2.259        0.264   1684.917   1.002</span>
<span class="co">#&gt; lambda[Ceará]            -0.762      -1.952        0.501   1706.125   1.001</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.687      -0.588        1.924   1624.420   1.001</span>
<span class="co">#&gt; lambda[Flamengo]          2.009       0.714        3.416   1883.759   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.579      -0.698        1.778   1668.638   1.001</span>
<span class="co">#&gt; lambda[Bahia]            -0.172      -1.374        1.058   1530.738   1.002</span>
<span class="co">#&gt; lambda[Fluminense]       -0.414      -1.704        0.770   1714.347   1.001</span>
<span class="co">#&gt; nu                        0.386       0.159        0.617   8030.593   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span></code></pre></div>
<div id="ranking" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with ties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that when we consider ties the rank has changed a bit and the difference between the teams reduce (we can see from both the parameter table as well as many equal median ranks between the teams).</p>
</div>
</div>
<div id="bradley-terry-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#bradley-terry-with-order-effect-home-advantage" class="anchor"></a>Bradley-Terry with order effect (home advantage)</h1>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d_home</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>home_player1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'bt-ordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'random'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -2.158      -3.487       -0.913   1748.367   1.002</span>
<span class="co">#&gt; lambda[Internacional]     0.271      -0.845        1.383   1148.703   1.004</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.314      -1.437        0.771   1168.378   1.003</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.556      -1.738        0.494   1211.140   1.004</span>
<span class="co">#&gt; lambda[Vasco]             0.035      -1.036        1.164   1188.221   1.004</span>
<span class="co">#&gt; lambda[Corinthians]       0.155      -0.978        1.239   1151.576   1.003</span>
<span class="co">#&gt; lambda[CSA]              -0.807      -1.911        0.343   1214.327   1.003</span>
<span class="co">#&gt; lambda[Goiás]             0.159      -0.969        1.251   1195.262   1.003</span>
<span class="co">#&gt; lambda[Fortaleza]         0.037      -0.993        1.207   1208.702   1.003</span>
<span class="co">#&gt; lambda[Santos]            0.879      -0.255        1.978   1219.297   1.003</span>
<span class="co">#&gt; lambda[Grêmio]            0.505      -0.540        1.611   1164.360   1.003</span>
<span class="co">#&gt; lambda[Palmeiras]         0.873      -0.278        1.977   1244.270   1.003</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.081      -1.167        1.051   1197.906   1.004</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.434      -1.560        0.665   1196.649   1.004</span>
<span class="co">#&gt; lambda[Ceará]            -0.314      -1.428        0.778   1206.242   1.004</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.506      -0.585        1.624   1203.768   1.003</span>
<span class="co">#&gt; lambda[Flamengo]          1.607       0.429        2.778   1344.365   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.387      -0.691        1.483   1161.431   1.003</span>
<span class="co">#&gt; lambda[Bahia]            -0.193      -1.271        0.957   1230.875   1.003</span>
<span class="co">#&gt; lambda[Fluminense]       -0.075      -1.168        1.009   1156.547   1.003</span>
<span class="co">#&gt; gm                       -0.410      -0.631       -0.177   9698.591   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see that the gm parameter is negative indicating that playing home indeed provide an advantage to the matches.</p>
<div id="ranking-1" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-1" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that the players ranking has changed a bit from the BT and the Davidson model when we compensate for the home advantage</p>
</div>
</div>
<div id="davidson-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#davidson-with-order-effect-home-advantage" class="anchor"></a>Davidson with order effect (home advantage)</h1>
<p>Now let’s fit our last model. The Davidson model with order effect. Here we take into account the ties and the home advantage effect</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'davidson-ordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher       n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ----------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -3.012      -4.667       -1.353    4186.366   1.000</span>
<span class="co">#&gt; lambda[Internacional]     0.022      -1.363        1.463    3089.693   1.001</span>
<span class="co">#&gt; lambda[Cruzeiro]         -1.007      -2.497        0.460    3358.494   1.000</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.808      -2.282        0.676    3763.771   1.001</span>
<span class="co">#&gt; lambda[Vasco]            -0.028      -1.520        1.437    3424.677   1.001</span>
<span class="co">#&gt; lambda[Corinthians]       0.382      -1.049        1.851    3356.959   1.001</span>
<span class="co">#&gt; lambda[CSA]              -1.617      -3.182       -0.134    3705.462   1.001</span>
<span class="co">#&gt; lambda[Goiás]            -0.020      -1.448        1.458    3452.993   1.000</span>
<span class="co">#&gt; lambda[Fortaleza]         0.366      -0.980        1.867    3606.935   1.001</span>
<span class="co">#&gt; lambda[Santos]            1.409      -0.068        2.919    3642.783   1.001</span>
<span class="co">#&gt; lambda[Grêmio]            0.954      -0.587        2.419    3513.745   1.001</span>
<span class="co">#&gt; lambda[Palmeiras]         1.813       0.296        3.329    4066.432   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]       0.169      -1.296        1.603    3330.499   1.001</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.239      -2.731        0.244    3575.311   1.001</span>
<span class="co">#&gt; lambda[Ceará]            -1.182      -2.714        0.232    3660.011   1.000</span>
<span class="co">#&gt; lambda[Athlético-PR]      1.163      -0.355        2.626    3618.416   1.001</span>
<span class="co">#&gt; lambda[Flamengo]          2.825       1.166        4.479    4416.153   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.779      -0.667        2.230    3664.680   1.000</span>
<span class="co">#&gt; lambda[Bahia]            -0.377      -1.822        1.122    3718.392   1.001</span>
<span class="co">#&gt; lambda[Fluminense]       -0.770      -2.225        0.706    3678.998   1.001</span>
<span class="co">#&gt; gm                       -3.892      -4.833       -2.925   13682.649   1.000</span>
<span class="co">#&gt; nu                        0.086      -0.123        0.300   16119.816   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see again that the home advantage gm parameter was negative, indicating that there is a home advantage effect.</p>
<div id="ranking-2" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-2" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage and ties:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="comparing-the-models-with-waic" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-the-models-with-waic" class="anchor"></a>Comparing the models with WAIC</h1>
<p>Let’s see now using an information criteria (the WAIC) which model fits the data better.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">m2_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="va">m3_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="va">m4_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>We can look at each waic:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -250.8  7.8</span>
<span class="co">#&gt; p_waic        19.6  0.8</span>
<span class="co">#&gt; waic         501.7 15.6</span>
<span class="va">m2_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -332.2 10.4</span>
<span class="co">#&gt; p_waic        19.4  1.1</span>
<span class="co">#&gt; waic         664.4 20.7</span>
<span class="va">m3_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -243.1  8.7</span>
<span class="co">#&gt; p_waic        20.8  1.0</span>
<span class="co">#&gt; waic         486.3 17.4</span>
<span class="va">m4_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -242.2  7.5</span>
<span class="co">#&gt; p_waic        17.0  0.7</span>
<span class="co">#&gt; waic         484.3 15.1</span></code></pre></div>
<p>Or can also use the loo::compare function to see which performs better.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span><span class="op">(</span><span class="va">m1_waic</span>,<span class="va">m2_waic</span>, <span class="va">m3_waic</span>, <span class="va">m4_waic</span><span class="op">)</span>
<span class="co">#&gt;        elpd_diff se_diff</span>
<span class="co">#&gt; model4   0.0       0.0  </span>
<span class="co">#&gt; model3  -1.0       6.6  </span>
<span class="co">#&gt; model1  -8.7       5.8  </span>
<span class="co">#&gt; model2 -90.0       7.4</span></code></pre></div>
<p>We can see here that the best performing model was the Davidson model (lowest WAIC)</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final remarks</h1>
<p>In this vignette, we looked at 4 different models. However, we have not explored the impact of different priors in the model performance. For example, we might have improved the home advantage models by setting more informative priors to restrict the parameter estimate (which in model 4 was quite large).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Issa Mattos, Erika Martins Silva Ramos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
