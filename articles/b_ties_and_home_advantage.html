<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home advantage in the Bradley-Terry and in the Davidson model • bpcs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Home advantage in the Bradley-Terry and in the Davidson model">
<meta property="og:description" content="bpcs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bpcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_get_started.html">Getting Started with the bpcs package</a>
    </li>
    <li>
      <a href="../articles/b_ties_and_home_advantage.html">Home advantage in the Bradley-Terry and in the Davidson model</a>
    </li>
    <li>
      <a href="../articles/c_bt_random_effects.html">Random effects in the Bradley-Terry model</a>
    </li>
    <li>
      <a href="../articles/d_paper.html">d_paper</a>
    </li>
    <li>
      <a href="../articles/e_contributing.html">e_contributing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidissamattos/bpcs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="b_ties_and_home_advantage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Home advantage in the Bradley-Terry and in the Davidson model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidissamattos/bpcs/blob/master/vignettes/b_ties_and_home_advantage.Rmd"><code>vignettes/b_ties_and_home_advantage.Rmd</code></a></small>
      <div class="hidden name"><code>b_ties_and_home_advantage.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/davidissamattos/bpcs">bpcs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="co">#Stan should use parallel cores</span>
<span class="co"># options(mc.cores = parallel::detectCores()) #use multiple cores</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#CRAN works only with max 2 cores</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we will go over a sport dataset that consists of the games from the main Brazilian football league from 2017-2019. In this example, we will create a ranking system for the teams based on the Bradley-Terry model. Then we will expand this to include ties, home-advantage effects and ties with home-advantage. Note that in this example we give equal weights to a game regardless of the date, i.e. more recent games have the same impact as older games.</p>
<p>The data can be accessed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"brasil_soccer_league"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">brasil_soccer_league</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Time
</th>
<th style="text-align:left;">
WeekDay
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
<th style="text-align:left;">
Stadium
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
19:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Arena Corinthians
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:left;">
Vitória
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Ressacada
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fonte Nova
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mineirão
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
11:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Fluminense
</td>
<td style="text-align:left;">
Santos
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Let’s analyze only the data from 2019 and remove a few columns that are not relevant for this example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">brasil_soccer_league</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">Date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">HomeTeam</span>, <span class="va">VisitorTeam</span>, <span class="va">ScoreHomeTeam</span>, <span class="va">ScoreVisitorTeam</span>, <span class="va">Round</span><span class="op">)</span> </code></pre></div>
<p>Now we have a smaller dataset (380 rows with 5 variables)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:left;">
Internacional
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:left;">
Botafogo-rj
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:left;">
Vasco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="fitting-a-bradley-terry-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-a-bradley-terry-model" class="anchor"></a>Fitting a Bradley-Terry model</h1>
<p>Let’s start fitting a simple Bradley-Terry model and handle ties randomly</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span>
  <span class="va">d</span>,
  player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>,
  player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>,
  player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
  player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
  model_type <span class="op">=</span> <span class="st">'bt'</span>,
  solve_ties <span class="op">=</span> <span class="st">'random'</span>,
  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span>,
  <span class="co"># making a more informative prior to improve convergence</span>
  iter <span class="op">=</span> <span class="fl">3000</span>
<span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<div id="simple-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-diagnostics" class="anchor"></a>Simple diagnostics</h2>
<p>Looking at the Rhat and the n_eff:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.176      -2.356       -0.035   1050.676   1.004</span>
<span class="co">#&gt; lambda[Internacional]     0.356      -0.757        1.422    927.831   1.006</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.311      -1.408        0.772    968.037   1.006</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.541      -1.640        0.527    929.220   1.006</span>
<span class="co">#&gt; lambda[Vasco]             0.020      -1.046        1.116    902.604   1.007</span>
<span class="co">#&gt; lambda[Corinthians]       0.243      -0.824        1.353    913.981   1.007</span>
<span class="co">#&gt; lambda[CSA]              -0.659      -1.744        0.465    906.085   1.006</span>
<span class="co">#&gt; lambda[Goiás]            -0.084      -1.211        0.987    864.154   1.006</span>
<span class="co">#&gt; lambda[Fortaleza]         0.138      -0.927        1.264    974.465   1.006</span>
<span class="co">#&gt; lambda[Santos]            0.830      -0.251        1.973    971.799   1.006</span>
<span class="co">#&gt; lambda[Grêmio]            0.472      -0.639        1.569    994.105   1.006</span>
<span class="co">#&gt; lambda[Palmeiras]         0.957      -0.168        2.052   1031.875   1.005</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.312      -1.366        0.805    921.652   1.006</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.774      -1.912        0.327   1050.567   1.006</span>
<span class="co">#&gt; lambda[Ceará]            -0.419      -1.507        0.700    854.315   1.006</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.471      -0.610        1.585    935.401   1.007</span>
<span class="co">#&gt; lambda[Flamengo]          1.367       0.236        2.525   1112.131   1.005</span>
<span class="co">#&gt; lambda[São Paulo]         0.357      -0.789        1.434    988.138   1.007</span>
<span class="co">#&gt; lambda[Bahia]            -0.086      -1.110        1.076    914.313   1.006</span>
<span class="co">#&gt; lambda[Fluminense]       -0.307      -1.356        0.843    966.150   1.006</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span></code></pre></div>
<p>Both look fine for all teams.</p>
<p>Looking at the traceplots for the first 4 teams only (we can look at the others or launch the shinystan app)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanfit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_stanfit.html">get_stanfit</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">posterior</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html">extract</a></span><span class="op">(</span><span class="va">stanfit</span>,inc_warmup<span class="op">=</span><span class="cn">T</span>,permuted<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">posterior</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda[1]"</span>,<span class="st">"lambda[2]"</span>,<span class="st">"lambda[3]"</span>,<span class="st">"lambda[4]"</span><span class="op">)</span>, n_warmup<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p><img src="b_ties_and_home_advantage_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>They sound ok so there is no reason why we should not trust our data</p>
</div>
<div id="ranking-with-the-bt-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-with-the-bt-model" class="anchor"></a>Ranking with the bt model</h2>
<p>Let’s get the rank with the simple <code>bt</code> model</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fitting-the-davidson-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-davidson-model" class="anchor"></a>Fitting the Davidson model</h1>
<p>Now lets investigate how ties impact our model</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          model_type <span class="op">=</span> <span class="st">'davidson'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.927      -3.262       -0.622   1810.439   1.004</span>
<span class="co">#&gt; lambda[Internacional]     0.141      -1.072        1.374   1661.729   1.005</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.705      -2.018        0.506   1694.353   1.003</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.605      -1.820        0.663   1728.817   1.003</span>
<span class="co">#&gt; lambda[Vasco]            -0.080      -1.299        1.189   1611.018   1.005</span>
<span class="co">#&gt; lambda[Corinthians]       0.288      -0.886        1.511   1529.079   1.005</span>
<span class="co">#&gt; lambda[CSA]              -1.123      -2.365        0.166   1637.464   1.004</span>
<span class="co">#&gt; lambda[Goiás]            -0.074      -1.260        1.219   1613.208   1.004</span>
<span class="co">#&gt; lambda[Fortaleza]         0.122      -1.029        1.443   1571.347   1.004</span>
<span class="co">#&gt; lambda[Santos]            1.056      -0.223        2.310   1676.372   1.004</span>
<span class="co">#&gt; lambda[Grêmio]            0.614      -0.625        1.870   1713.893   1.004</span>
<span class="co">#&gt; lambda[Palmeiras]         1.229      -0.036        2.499   1748.364   1.004</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.064      -1.324        1.114   1581.515   1.004</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.003      -2.301        0.233   1637.083   1.003</span>
<span class="co">#&gt; lambda[Ceará]            -0.734      -1.957        0.486   1536.351   1.004</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.702      -0.465        1.971   1640.200   1.004</span>
<span class="co">#&gt; lambda[Flamengo]          2.033       0.689        3.400   1909.899   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.597      -0.613        1.881   1625.139   1.004</span>
<span class="co">#&gt; lambda[Bahia]            -0.149      -1.307        1.113   1558.747   1.004</span>
<span class="co">#&gt; lambda[Fluminense]       -0.396      -1.623        0.835   1610.884   1.006</span>
<span class="co">#&gt; nu                        0.387       0.160        0.615   9410.631   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span></code></pre></div>
<div id="ranking" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with ties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that when we consider ties the rank has changed a bit and the difference between the teams reduce (we can see from both the parameter table as well as many equal median ranks between the teams).</p>
</div>
</div>
<div id="bradley-terry-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#bradley-terry-with-order-effect-home-advantage" class="anchor"></a>Bradley-Terry with order effect (home advantage)</h1>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d_home</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>home_player1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'btordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'random'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.310      -2.470       -0.195    856.502   1.003</span>
<span class="co">#&gt; lambda[Internacional]     0.231      -0.800        1.338    804.642   1.004</span>
<span class="co">#&gt; lambda[Cruzeiro]         -1.020      -2.180        0.065    794.462   1.003</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.498      -1.583        0.588    786.209   1.004</span>
<span class="co">#&gt; lambda[Vasco]             0.234      -0.862        1.369    841.621   1.003</span>
<span class="co">#&gt; lambda[Corinthians]       0.358      -0.737        1.459    830.210   1.003</span>
<span class="co">#&gt; lambda[CSA]              -0.754      -1.829        0.374    798.764   1.003</span>
<span class="co">#&gt; lambda[Goiás]            -0.013      -1.123        1.033    781.831   1.003</span>
<span class="co">#&gt; lambda[Fortaleza]        -0.126      -1.261        0.927    762.365   1.003</span>
<span class="co">#&gt; lambda[Santos]            0.736      -0.372        1.845    841.345   1.003</span>
<span class="co">#&gt; lambda[Grêmio]            0.605      -0.523        1.692    802.042   1.004</span>
<span class="co">#&gt; lambda[Palmeiras]         0.868      -0.187        2.001    778.619   1.003</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.008      -1.058        1.121    778.307   1.003</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.620      -1.743        0.452    786.960   1.004</span>
<span class="co">#&gt; lambda[Ceará]            -0.498      -1.630        0.598    779.700   1.003</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.109      -1.034        1.158    718.810   1.004</span>
<span class="co">#&gt; lambda[Flamengo]          1.812       0.592        3.056    967.772   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.357      -0.696        1.492    775.168   1.003</span>
<span class="co">#&gt; lambda[Bahia]            -0.130      -1.229        0.936    705.632   1.003</span>
<span class="co">#&gt; lambda[Fluminense]       -0.374      -1.467        0.720    770.674   1.003</span>
<span class="co">#&gt; gm                       -0.641      -0.874       -0.403   7285.994   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see that the gm parameter is negative indicating that playing home indeed provide an advantage to the matches.</p>
<div id="ranking-1" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-1" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that the players ranking has changed a bit from the BT and the Davidson model when we compensate for the home advantage</p>
</div>
</div>
<div id="davidson-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#davidson-with-order-effect-home-advantage" class="anchor"></a>Davidson with order effect (home advantage)</h1>
<p>Now let’s fit our last model. The Davidson model with order effect. Here we take into account the ties and the home advantage effect</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'davidsonordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher       n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ----------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -2.998      -4.615       -1.335    4545.121   1.000</span>
<span class="co">#&gt; lambda[Internacional]     0.024      -1.407        1.486    3675.516   1.001</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.988      -2.407        0.524    3933.468   1.000</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.790      -2.293        0.642    3343.831   1.000</span>
<span class="co">#&gt; lambda[Vasco]            -0.015      -1.480        1.451    3649.233   1.000</span>
<span class="co">#&gt; lambda[Corinthians]       0.391      -1.081        1.821    3818.798   1.001</span>
<span class="co">#&gt; lambda[CSA]              -1.601      -3.088       -0.093    3519.217   1.001</span>
<span class="co">#&gt; lambda[Goiás]            -0.006      -1.501        1.445    3848.737   1.000</span>
<span class="co">#&gt; lambda[Fortaleza]         0.379      -1.111        1.873    3856.558   1.000</span>
<span class="co">#&gt; lambda[Santos]            1.422      -0.031        2.963    3846.817   1.001</span>
<span class="co">#&gt; lambda[Grêmio]            0.972      -0.466        2.501    3905.447   1.001</span>
<span class="co">#&gt; lambda[Palmeiras]         1.838       0.317        3.398    4159.780   1.000</span>
<span class="co">#&gt; lambda[Atlético-MG]       0.179      -1.217        1.669    3490.410   1.000</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.221      -2.704        0.313    3809.603   1.000</span>
<span class="co">#&gt; lambda[Ceará]            -1.170      -2.716        0.257    3510.362   1.000</span>
<span class="co">#&gt; lambda[Athlético-PR]      1.173      -0.331        2.660    4113.636   1.000</span>
<span class="co">#&gt; lambda[Flamengo]          2.822       1.150        4.464    4852.095   1.000</span>
<span class="co">#&gt; lambda[São Paulo]         0.802      -0.638        2.313    3528.490   1.001</span>
<span class="co">#&gt; lambda[Bahia]            -0.357      -1.842        1.072    3879.083   1.001</span>
<span class="co">#&gt; lambda[Fluminense]       -0.752      -2.223        0.703    3875.261   1.001</span>
<span class="co">#&gt; nu                        0.087      -0.124        0.301   12810.601   1.000</span>
<span class="co">#&gt; gm                       -3.894      -4.849       -2.996   11639.798   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see again that the home advantage gm parameter was negative, indicating that there is a home advantage effect.</p>
<div id="ranking-2" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-2" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage and ties:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="comparing-the-models-with-waic" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-the-models-with-waic" class="anchor"></a>Comparing the models with WAIC</h1>
<p>Let’s see now using an information criteria (the WAIC) which model fits the data better.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">m2_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="va">m3_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="va">m4_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>We can look at each waic:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -253.9  7.6</span>
<span class="co">#&gt; p_waic        19.6  0.8</span>
<span class="co">#&gt; waic         507.9 15.1</span>
<span class="va">m2_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -332.2 10.4</span>
<span class="co">#&gt; p_waic        19.4  1.1</span>
<span class="co">#&gt; waic         664.3 20.7</span>
<span class="va">m3_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -238.4  8.9</span>
<span class="co">#&gt; p_waic        20.7  1.0</span>
<span class="co">#&gt; waic         476.8 17.8</span>
<span class="va">m4_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -382.3 18.6</span>
<span class="co">#&gt; p_waic        35.5  1.8</span>
<span class="co">#&gt; waic         764.6 37.2</span></code></pre></div>
<p>Or can also use the loo::compare function to see which performs better.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span><span class="op">(</span><span class="va">m1_waic</span>,<span class="va">m2_waic</span>, <span class="va">m3_waic</span>, <span class="va">m4_waic</span><span class="op">)</span>
<span class="co">#&gt;        elpd_diff se_diff</span>
<span class="co">#&gt; model3    0.0       0.0 </span>
<span class="co">#&gt; model1  -15.5       8.2 </span>
<span class="co">#&gt; model2  -93.8      12.5 </span>
<span class="co">#&gt; model4 -143.9      14.7</span></code></pre></div>
<p>We can see here that the best performing model was the Davidson model (lowest WAIC)</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final remarks</h1>
<p>In this vignette, we looked at 4 different models. However, we have not explored the impact of different priors in the model performance. For example, we might have improved the home advantage models by setting more informative priors to restrict the parameter estimate (which in model 4 was quite large).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Issa Mattos, Erika Martins Silva Ramos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
