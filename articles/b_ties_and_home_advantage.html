<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home advantage in the Bradley-Terry and in the Davidson model • bpcs</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Home advantage in the Bradley-Terry and in the Davidson model">
<meta property="og:description" content="bpcs">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bpcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_get_started.html">Getting Started with the bpcs package</a>
    </li>
    <li>
      <a href="../articles/b_ties_and_home_advantage.html">Home advantage in the Bradley-Terry and in the Davidson model</a>
    </li>
    <li>
      <a href="../articles/c_bt_random_effects.html">Random effects in the Bradley-Terry model</a>
    </li>
    <li>
      <a href="../articles/d_paper.html">d_paper</a>
    </li>
    <li>
      <a href="../articles/e_contributing.html">Contributing guide</a>
    </li>
    <li>
      <a href="../articles/overview.html">Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidissamattos/bpcs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="b_ties_and_home_advantage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="b_ties_and_home_advantage_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Home advantage in the Bradley-Terry and in the Davidson model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davidissamattos/bpcs/blob/master/vignettes/b_ties_and_home_advantage.Rmd"><code>vignettes/b_ties_and_home_advantage.Rmd</code></a></small>
      <div class="hidden name"><code>b_ties_and_home_advantage.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/davidissamattos/bpcs">bpcs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="co">#Stan should use parallel cores</span>
<span class="co"># options(mc.cores = parallel::detectCores()) #use multiple cores</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#CRAN works only with max 2 cores</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we will go over a sport dataset that consists of the games from the main Brazilian football league from 2017-2019. In this example, we will create a ranking system for the teams based on the Bradley-Terry model. Then we will expand this to include ties, home-advantage effects and ties with home-advantage. Note that in this example we give equal weights to a game regardless of the date, i.e. more recent games have the same impact as older games.</p>
<p>The data can be accessed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"brasil_soccer_league"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">brasil_soccer_league</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Time
</th>
<th style="text-align:left;">
WeekDay
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
<th style="text-align:left;">
Stadium
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
19:00
</td>
<td style="text-align:left;">
Saturday
</td>
<td style="text-align:left;">
2017-05-13
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Arena Corinthians
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:left;">
Vitória
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Ressacada
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Fonte Nova
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
16:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mineirão
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
11:00
</td>
<td style="text-align:left;">
Sunday
</td>
<td style="text-align:left;">
2017-05-14
</td>
<td style="text-align:left;">
Fluminense
</td>
<td style="text-align:left;">
Santos
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Maracanã
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Let’s analyze only the data from 2019 and remove a few columns that are not relevant for this example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">brasil_soccer_league</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">&amp;</span>
                  <span class="va">Date</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">HomeTeam</span>, <span class="va">VisitorTeam</span>, <span class="va">ScoreHomeTeam</span>, <span class="va">ScoreVisitorTeam</span>, <span class="va">Round</span><span class="op">)</span> </code></pre></div>
<p>Now we have a smaller dataset (380 rows with 5 variables)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
HomeTeam
</th>
<th style="text-align:left;">
VisitorTeam
</th>
<th style="text-align:right;">
ScoreHomeTeam
</th>
<th style="text-align:right;">
ScoreVisitorTeam
</th>
<th style="text-align:right;">
Round
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Atlético-MG
</td>
<td style="text-align:left;">
Avaí
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chapecoense
</td>
<td style="text-align:left;">
Internacional
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Flamengo
</td>
<td style="text-align:left;">
Cruzeiro
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
São Paulo
</td>
<td style="text-align:left;">
Botafogo-rj
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Athlético-PR
</td>
<td style="text-align:left;">
Vasco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bahia
</td>
<td style="text-align:left;">
Corinthians
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="fitting-a-bradley-terry-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-a-bradley-terry-model" class="anchor"></a>Fitting a Bradley-Terry model</h1>
<p>Let’s start fitting a simple Bradley-Terry model and handle ties randomly</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span>
  <span class="va">d</span>,
  player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>,
  player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>,
  player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
  player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
  model_type <span class="op">=</span> <span class="st">'bt'</span>,
  solve_ties <span class="op">=</span> <span class="st">'random'</span>,
  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span>,
  <span class="co"># making a more informative prior to improve convergence</span>
  iter <span class="op">=</span> <span class="fl">3000</span>
<span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<div id="simple-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-diagnostics" class="anchor"></a>Simple diagnostics</h2>
<p>Looking at the Rhat and the n_eff:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher     n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  --------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.237      -2.358       -0.063   937.525   1.002</span>
<span class="co">#&gt; lambda[Internacional]    -0.034      -1.139        1.039   821.906   1.003</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.253      -1.354        0.825   798.860   1.002</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.487      -1.585        0.586   796.515   1.003</span>
<span class="co">#&gt; lambda[Vasco]            -0.370      -1.444        0.751   825.073   1.003</span>
<span class="co">#&gt; lambda[Corinthians]       0.308      -0.785        1.386   814.907   1.002</span>
<span class="co">#&gt; lambda[CSA]              -0.844      -1.943        0.309   859.988   1.002</span>
<span class="co">#&gt; lambda[Goiás]            -0.258      -1.385        0.815   847.834   1.002</span>
<span class="co">#&gt; lambda[Fortaleza]         0.077      -0.981        1.227   830.989   1.002</span>
<span class="co">#&gt; lambda[Santos]            0.913      -0.178        2.096   876.579   1.003</span>
<span class="co">#&gt; lambda[Grêmio]            0.304      -0.765        1.437   841.530   1.003</span>
<span class="co">#&gt; lambda[Palmeiras]         1.183       0.081        2.350   931.436   1.002</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.150      -1.201        0.943   846.849   1.002</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.843      -1.941        0.310   880.178   1.002</span>
<span class="co">#&gt; lambda[Ceará]            -0.840      -1.949        0.312   892.628   1.003</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.416      -0.680        1.506   825.111   1.003</span>
<span class="co">#&gt; lambda[Flamengo]          1.329       0.193        2.491   889.808   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.306      -0.756        1.414   828.613   1.002</span>
<span class="co">#&gt; lambda[Bahia]             0.080      -1.040        1.134   856.633   1.003</span>
<span class="co">#&gt; lambda[Fluminense]       -0.146      -1.154        1.016   839.719   1.002</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span></code></pre></div>
<p>Both look fine for all teams.</p>
<p>Looking at the traceplots for the first 4 teams only (we can look at the others or launch the shinystan app)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanfit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_stanfit.html">get_stanfit</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">posterior</span><span class="op">&lt;-</span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html">extract</a></span><span class="op">(</span><span class="va">stanfit</span>,inc_warmup<span class="op">=</span><span class="cn">T</span>,permuted<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">posterior</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda[1]"</span>,<span class="st">"lambda[2]"</span>,<span class="st">"lambda[3]"</span>,<span class="st">"lambda[4]"</span><span class="op">)</span>, n_warmup<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p><img src="b_ties_and_home_advantage_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>They sound ok so there is no reason why we should not trust our data</p>
</div>
<div id="ranking-with-the-bt-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-with-the-bt-model" class="anchor"></a>Ranking with the bt model</h2>
<p>Let’s get the rank with the simple <code>bt</code> model</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fitting-the-davidson-model" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-davidson-model" class="anchor"></a>Fitting the Davidson model</h1>
<p>Now lets investigate how ties impact our model</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          model_type <span class="op">=</span> <span class="st">'davidson'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.915      -3.264       -0.592   2087.479   1.002</span>
<span class="co">#&gt; lambda[Internacional]     0.155      -1.022        1.446   1528.628   1.004</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.684      -1.945        0.569   1647.547   1.003</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.588      -1.881        0.669   1665.880   1.003</span>
<span class="co">#&gt; lambda[Vasco]            -0.070      -1.284        1.210   1684.089   1.004</span>
<span class="co">#&gt; lambda[Corinthians]       0.303      -0.987        1.499   1391.329   1.004</span>
<span class="co">#&gt; lambda[CSA]              -1.103      -2.372        0.184   1587.202   1.003</span>
<span class="co">#&gt; lambda[Goiás]            -0.066      -1.401        1.093   1452.799   1.004</span>
<span class="co">#&gt; lambda[Fortaleza]         0.128      -1.171        1.320   1462.319   1.004</span>
<span class="co">#&gt; lambda[Santos]            1.071      -0.174        2.360   1622.304   1.003</span>
<span class="co">#&gt; lambda[Grêmio]            0.625      -0.668        1.866   1691.545   1.003</span>
<span class="co">#&gt; lambda[Palmeiras]         1.237      -0.049        2.567   1802.450   1.003</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.055      -1.297        1.210   1788.576   1.003</span>
<span class="co">#&gt; lambda[Chapecoense]      -0.993      -2.306        0.250   1733.371   1.003</span>
<span class="co">#&gt; lambda[Ceará]            -0.728      -1.987        0.476   1579.456   1.003</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.718      -0.490        2.009   1649.154   1.003</span>
<span class="co">#&gt; lambda[Flamengo]          2.035       0.638        3.397   2053.549   1.003</span>
<span class="co">#&gt; lambda[São Paulo]         0.609      -0.655        1.814   1482.037   1.004</span>
<span class="co">#&gt; lambda[Bahia]            -0.137      -1.417        1.076   1442.407   1.004</span>
<span class="co">#&gt; lambda[Fluminense]       -0.387      -1.605        0.910   1667.891   1.004</span>
<span class="co">#&gt; nu                        0.386       0.160        0.628   9659.077   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span></code></pre></div>
<div id="ranking" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with ties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>We can see that when we consider ties the rank has changed a bit and the difference between the teams reduce (we can see from both the parameter table as well as many equal median ranks between the teams).</p>
</div>
</div>
<div id="bradley-terry-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#bradley-terry-with-order-effect-home-advantage" class="anchor"></a>Bradley-Terry with order effect (home advantage)</h1>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d_home</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>home_player1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'btordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'random'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher      n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ---------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -1.146      -2.365       -0.003    979.100   1.004</span>
<span class="co">#&gt; lambda[Internacional]     0.232      -0.845        1.368    895.781   1.003</span>
<span class="co">#&gt; lambda[Cruzeiro]         -0.868      -2.004        0.269    947.285   1.003</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.491      -1.662        0.615    965.275   1.003</span>
<span class="co">#&gt; lambda[Vasco]             0.113      -1.018        1.241    918.076   1.003</span>
<span class="co">#&gt; lambda[Corinthians]       0.604      -0.498        1.795    947.404   1.003</span>
<span class="co">#&gt; lambda[CSA]              -0.611      -1.778        0.516    892.916   1.003</span>
<span class="co">#&gt; lambda[Goiás]            -0.369      -1.457        0.799    908.593   1.003</span>
<span class="co">#&gt; lambda[Fortaleza]        -0.007      -1.077        1.130    926.288   1.003</span>
<span class="co">#&gt; lambda[Santos]            1.006      -0.196        2.112    990.330   1.002</span>
<span class="co">#&gt; lambda[Grêmio]            0.600      -0.560        1.712    905.728   1.004</span>
<span class="co">#&gt; lambda[Palmeiras]         1.001      -0.150        2.190    954.322   1.003</span>
<span class="co">#&gt; lambda[Atlético-MG]      -0.493      -1.606        0.646    926.937   1.002</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.009      -2.209        0.118    951.305   1.003</span>
<span class="co">#&gt; lambda[Ceará]            -0.491      -1.649        0.626    908.882   1.003</span>
<span class="co">#&gt; lambda[Athlético-PR]      0.112      -1.008        1.251    939.771   1.003</span>
<span class="co">#&gt; lambda[Flamengo]          2.020       0.762        3.316   1231.759   1.002</span>
<span class="co">#&gt; lambda[São Paulo]         0.356      -0.749        1.509    944.054   1.002</span>
<span class="co">#&gt; lambda[Bahia]            -0.124      -1.238        0.990    894.293   1.003</span>
<span class="co">#&gt; lambda[Fluminense]       -0.247      -1.395        0.834    877.820   1.002</span>
<span class="co">#&gt; gm                       -0.542      -0.764       -0.290   7184.234   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see that the gm parameter is negative indicating that playing home indeed provide an advantage to the matches.</p>
<div id="ranking-1" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-1" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
19
</td>
</tr>
</tbody>
</table>
<p>We can see that the players ranking has changed a bit from the BT and the Davidson model when we compensate for the home advantage</p>
</div>
</div>
<div id="davidson-with-order-effect-home-advantage" class="section level1">
<h1 class="hasAnchor">
<a href="#davidson-with-order-effect-home-advantage" class="anchor"></a>Davidson with order effect (home advantage)</h1>
<p>Now let’s fit our last model. The Davidson model with order effect. Here we take into account the ties and the home advantage effect</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bpc.html">bpc</a></span><span class="op">(</span><span class="va">d_home</span>, 
          player0 <span class="op">=</span> <span class="st">'VisitorTeam'</span>, 
          player1 <span class="op">=</span>  <span class="st">'HomeTeam'</span>, 
          player0_score <span class="op">=</span> <span class="st">'ScoreVisitorTeam'</span>,
          player1_score <span class="op">=</span> <span class="st">'ScoreHomeTeam'</span>,
          z_player1 <span class="op">=</span> <span class="st">'home_player1'</span>,
          model_type <span class="op">=</span> <span class="st">'davidsonordereffect'</span>,
          solve_ties <span class="op">=</span> <span class="st">'none'</span>,
          priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>prior_lambda_std<span class="op">=</span><span class="fl">2.0</span><span class="op">)</span>, <span class="co"># making a more informative prior to improve convergence</span>
          iter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="co">#stan indicates a low bulk ESS so we are increasing the number of iterations</span></code></pre></div>
<p>For sake of space and repetition we will not present the diagnostics which can be observed at:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/launch_shinystan.html">launch_shinystan</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>Let’s look at the parameters</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span>
<span class="co">#&gt; Estimated baseline parameters with HPD intervals:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameter                  Mean   HPD_lower   HPD_higher       n_eff    Rhat</span>
<span class="co">#&gt; ----------------------  -------  ----------  -----------  ----------  ------</span>
<span class="co">#&gt; lambda[Avaí]             -3.019      -4.729       -1.411    4048.025   1.001</span>
<span class="co">#&gt; lambda[Internacional]     0.014      -1.433        1.497    3328.991   1.003</span>
<span class="co">#&gt; lambda[Cruzeiro]         -1.002      -2.518        0.499    3282.799   1.002</span>
<span class="co">#&gt; lambda[Botafogo-rj]      -0.811      -2.250        0.737    3322.359   1.001</span>
<span class="co">#&gt; lambda[Vasco]            -0.036      -1.528        1.451    3559.131   1.002</span>
<span class="co">#&gt; lambda[Corinthians]       0.374      -1.027        1.905    3561.671   1.001</span>
<span class="co">#&gt; lambda[CSA]              -1.627      -3.188       -0.089    3584.136   1.002</span>
<span class="co">#&gt; lambda[Goiás]            -0.031      -1.482        1.428    3497.695   1.001</span>
<span class="co">#&gt; lambda[Fortaleza]         0.367      -1.077        1.865    3669.152   1.002</span>
<span class="co">#&gt; lambda[Santos]            1.414      -0.069        2.927    3472.448   1.002</span>
<span class="co">#&gt; lambda[Grêmio]            0.956      -0.584        2.420    3676.254   1.002</span>
<span class="co">#&gt; lambda[Palmeiras]         1.810       0.256        3.370    3707.217   1.001</span>
<span class="co">#&gt; lambda[Atlético-MG]       0.162      -1.334        1.646    3255.792   1.001</span>
<span class="co">#&gt; lambda[Chapecoense]      -1.237      -2.715        0.271    3496.670   1.001</span>
<span class="co">#&gt; lambda[Ceará]            -1.193      -2.644        0.273    3248.155   1.002</span>
<span class="co">#&gt; lambda[Athlético-PR]      1.143      -0.325        2.636    3462.526   1.001</span>
<span class="co">#&gt; lambda[Flamengo]          2.804       1.086        4.417    4103.855   1.001</span>
<span class="co">#&gt; lambda[São Paulo]         0.781      -0.752        2.178    3529.856   1.001</span>
<span class="co">#&gt; lambda[Bahia]            -0.377      -1.827        1.089    3379.821   1.002</span>
<span class="co">#&gt; lambda[Fluminense]       -0.776      -2.198        0.748    3423.479   1.001</span>
<span class="co">#&gt; nu                        0.089      -0.115        0.297   12473.448   1.000</span>
<span class="co">#&gt; gm                       -3.890      -4.872       -2.970   10149.025   1.000</span>
<span class="co">#&gt; NOTES:</span>
<span class="co">#&gt; * A higher lambda indicates a higher team ability</span>
<span class="co">#&gt; * Large positive values of the nu parameter indicates a high probability of tie regardless of the abilities of theplayers.</span>
<span class="co">#&gt; * Large negative values of the nu parameter indicates a low probability of tie regardless of the abilities of the players.</span>
<span class="co">#&gt; * Values of nu close to zero indicate that the probability of tie is more dependable on abilities of the players. If nu=0 the model reduces to the Bradley-Terry model.</span>
<span class="co">#&gt; * Large positive values of the gm parameter indicate that player 1 has a disadvantage. E.g. in a home effect scenario positive values indicate a home disadvantage.</span>
<span class="co">#&gt; * Large negative values of the gm parameter indicate that player 1 has an advantage. E.g. in a home effect scenario negative values indicate a home advantage.</span>
<span class="co">#&gt; * Values of gm close to zero indicate that the order effect does not influence the contest. E.g. in a home effect it indicates that player 1 does not have a home advantage nor disadvantage.</span></code></pre></div>
<p>We can see again that the home advantage gm parameter was negative, indicating that there is a home advantage effect.</p>
<div id="ranking-2" class="section level2">
<h2 class="hasAnchor">
<a href="#ranking-2" class="anchor"></a>Ranking</h2>
<p>Let’s look at the ranking with home advantage and ties:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_rank_of_players.html">get_rank_of_players</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Parameter</span>, <span class="va">MedianRank</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Flamengo]
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Palmeiras]
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Santos]
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Athlético-PR]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Grêmio]
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[São Paulo]
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Corinthians]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fortaleza]
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Atlético-MG]
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Internacional]
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Goiás]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Vasco]
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Bahia]
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Botafogo-rj]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Fluminense]
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Cruzeiro]
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Ceará]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Chapecoense]
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[CSA]
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Avaí]
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="comparing-the-models-with-waic" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-the-models-with-waic" class="anchor"></a>Comparing the models with WAIC</h1>
<p>Let’s see now using an information criteria (the WAIC) which model fits the data better.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="va">m2_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="va">m3_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span>
<span class="va">m4_waic</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/get_waic.html">get_waic</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></code></pre></div>
<p>We can look at each waic:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -250.2  8.0</span>
<span class="co">#&gt; p_waic        19.9  0.8</span>
<span class="co">#&gt; waic         500.5 16.0</span>
<span class="va">m2_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -332.2 10.3</span>
<span class="co">#&gt; p_waic        19.4  1.1</span>
<span class="co">#&gt; waic         664.4 20.7</span>
<span class="va">m3_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -237.0  9.0</span>
<span class="co">#&gt; p_waic        20.7  1.0</span>
<span class="co">#&gt; waic         473.9 18.0</span>
<span class="va">m4_waic</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computed from 8000 by 380 log-likelihood matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Estimate   SE</span>
<span class="co">#&gt; elpd_waic   -382.4 18.6</span>
<span class="co">#&gt; p_waic        36.1  1.8</span>
<span class="co">#&gt; waic         764.9 37.2</span></code></pre></div>
<p>Or can also use the loo::compare function to see which performs better.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span><span class="op">(</span><span class="va">m1_waic</span>,<span class="va">m2_waic</span>, <span class="va">m3_waic</span>, <span class="va">m4_waic</span><span class="op">)</span>
<span class="co">#&gt;        elpd_diff se_diff</span>
<span class="co">#&gt; model3    0.0       0.0 </span>
<span class="co">#&gt; model1  -13.3       8.4 </span>
<span class="co">#&gt; model2  -95.2      11.8 </span>
<span class="co">#&gt; model4 -145.5      15.4</span></code></pre></div>
<p>We can see here that the best performing model was the Davidson model (lowest WAIC)</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final remarks</h1>
<p>In this vignette, we looked at 4 different models. However, we have not explored the impact of different priors in the model performance. For example, we might have improved the home advantage models by setting more informative priors to restrict the parameter estimate (which in model 4 was quite large).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Issa Mattos, Erika Martins Silva Ramos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
