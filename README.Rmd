---
output: github_document
bibliography: ./vignettes/bibliography.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
library(badger)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# bpcs - A package for Bayesian Paired Comparison analysis with Stan <img src="https://github.com/davidissamattos/bpcs/blob/master/inst/logo/logo.png" align="right" width="120" />

<!-- badges: start -->
`r badge_license('MIT', color='yellow')`
`r badge_last_commit("davidissamattos/bpcs")`
`r badge_lifecycle("stable")`
`r badge_code_size("davidissamattos/bpcs")`
`r badge_devel("davidissamattos/bpcs", "blue")`
`r badge_codecov("davidissamattos/bpcs")`
<!-- badges: end -->

The `bpcs` package performs Bayesian estimation of Paired Comparison models utilizing Stan, such as variations of the Bradley-Terry [@bradley1952rank] and the Davidson models [@davidson1970extending].

Package documentation and vignette articles can be found at: https://davidissamattos.github.io/bpcs/


## Installation

For the `bpcs` package to work, we rely upon the Stan software and the `rstan` package [@rstan]. 

* For general installation of Stan and RStan see: https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started
* For macOS: https://github.com/stan-dev/rstan/wiki/Installing-RStan-from-source-on-a-Mac
* For Linux: https://github.com/stan-dev/rstan/wiki/Installing-RStan-on-Linux
* For Windows: https://github.com/stan-dev/rstan/wiki/Installing-RStan-from-source-on-Windows 

<!-- To install the latest stable version from CRAN -->

<!-- ```{r eval=FALSE, echo=T} -->
<!-- install.packages('bpcs') -->
<!-- ``` -->


To install the development version of the bpcs package, install directly from the Github repository.

```{r eval=FALSE, echo=T}
remotes::install_github('davidissamattos/bpcs')
```

After install we load the package with:
```{r}
library(bpcs)
```

## Minimal example

The main function of the package is the `bpc` function. For the simple Bradley-Terry model, this function requires a specific type of data frame that contains:

* Two columns containing the name of the contestants in the paired comparison
* Two columns containing the score of each player OR  one column containing the result of the match (0 if player0 won, 1 if player1 won, 2 if it was a tie)

We will utilize the tennis dataset available [@agresti2003categorical]. The dataset can be seen below and is available as `data(tennis_agresti)`:

```{r}
sample_n(tennis_agresti,10) %>% 
  knitr::kable()
```

Based on the scores of each contestant, the `bpc` function computes automatically who won the contest. Alternatively, you can provide a vector of who won if that is already available (for more information see `?bpc`.


For the simple Bradley Terry Model we specify the model type as `'bt'`. Here we hide the MCMC sampler chain messages for simplicity in the output. 

```{r}
m<-bpc(data = tennis_agresti, #datafrane
       player0 = 'player0', #name of the column for player 0
       player1 = 'player1', #name of the column for player 1
       result_column = 'y', #name of the column for the result of the match
       model_type = 'bt', #bt = Simple Bradley Terry model
       solve_ties = 'none' #there are no ties in the dataset so we can choose none here
       )
```

If `rstan` is available and correctly working this function should sample the posterior distribution and create a `bpc` object.

To see a summary of the results we can run the summary function. Here we get three tables:

1- The parameters of the model
2- The probabilities of one player beating the other (this probability is based on the predictive posterior distribution)
3- The rank of the player based on their abilities (this rank is based on the predictive posterior ranks).

```{r}
summary(m)
```


# Features of the bpcs package

* Bayesian computation of different variations of the Bradley-Terry (including with home advantage, random effects and the generalized model).
* Bayesian computation of different variations of the Davidson model to handle ties in the contest (including with home advantage, random effects and the generalized model).
* Accepts a column with the results of the contest or the scores for each player.
* Customize a normal prior distribution for every parameter.
* Compute HDP interval for every parameter with the `get_hpdi_parameters` function
* Compute rank of the players with the `get_rank_of_players` function.
* Compute all the probability combinations for one player beating the other with the `get_probabilities` function.
* Convert aggregated tables of results into long format (one contest per row) with the `expand_aggregated_data.`
* Obtain the posterior distribution for every parameter of the model with the `get_sample_posterior` function.
* Easy predictions using the `predict` function.
* We do not reinforce any table or plotting library! Results are returned as data frames for easier plotting and creating tables
* We reinforce the need to manually specify the model to be used.

## Models available

* Bradley-Terry (`bt`)  [@bradley1952rank]
* Davidson model (`davidson`) for handling ties [@davidson1970extending]
* Bradley-Terry with order effect (`btordereffect`). E.g. for home advantage [@davidson1977extending]
* Davidson model with order effect (`davidsonordereffect`). E.g. for home advantage with ties [@davidson1977extending]
* Generalized Bradley-Terry model (`btgeneralized`). When we have contestant specific predictors [@springall1973response]
* Generalized Davidson model (`davidsongeneralized`). When we have contestant specific predictors and ties
* Bradley-Terry model with intercept random effects (`btU`). For example to compensate clustering or repeated measures [@bockenholt2001hierarchical]
* Davidson model with intercept random effects (`davidsonU`). For example to compensate clustering or repeated measures when we have ties.

Note that we currently don't variations and combinations of these models (e.g BT with order effect and random effect or generalized BT with order effect). Contact me if there is a need for one of these models and give me some examples so we can add to the vignettes!

## Roadmap

### Goals for bpcs 1.0.0 (before Chirstmas 2020)

- First official release
- Working and tested models for `bt`, `btordereffect`, `btgeneralized`, `btU`, `davidson`, `davidsonordereffect`, `davidsongeneralized`, `davidsonU`
- Vignettes covering most models

### Goals for bpcs 1.1.0 (Before June 2021)

- Reduce installation time by reducing number of stan models
  - The goal is to have fewer but more general stan models. 
  - This will increase the complexity of the stan model but will reduce code for the predict, get_probabilities, and the bpc function
- Add new models for modeling time effects (newer contests have higher impact on the ability than older contests)
- Add model for the Bayesian ELO-type rating system
- Improve test coverage


# Vignettes

This package provides a series of small and self contained vignettes that exemplify the use of each model. In the vignettes, we also provide examples of code for data transformation, tables and plots.

Below we list all our vignettes with a short description:

* [Getting Started](https://davidissamattos.github.io/bpcs/articles/a_get_started.html): This vignette shows a basic example on tennis competition data, covering how to run a Bradley-Terry model, MCMC diagnostics, posterior predictive values, ranking, predict new matches

* [Ties and home advantage](https://davidissamattos.github.io/bpcs/articles/b_ties_and_home_advantage.html): This vignette covers a soccer example from the Brazilian soccer league. Here, we first model the results using a Bradley-Terry model and the Davidson model to handle ties. Then, we extend both models to include for order effects, this allows us to investigate the home advantage in and without the presence of ties.

* [Bradley-Terry with random effects](https://davidissamattos.github.io/bpcs/articles/c_bt_random_effects.html): This vignette covers the problem of ranking black-box optimization algorithms based on benchmarks. Since in benchmarking we often run the same optimization algorithm more than once with the same benchmark problem, we need to compensate for the repeated measures effect. We deal with this utilizing a simple Bradley-Terry model with random effects.

<!-- * [Generalized Bradley-Terry model](): This vignette investigate the Bradley-Terry model when we have players specific characteristics. (TODO) -->

<!-- * [Paper](): This paper/vignette describes the theory and related work behind the presented models. TODO -->


# Contributing and bugs

If you are interested you are welcome to contribute to the repository through pull requests. 
<!-- We have a short [contributing guide vignette](https://davidissamattos.github.io/bpcs/articles/e_contributing.html). -->

If you find bugs, please report it in https://github.com/davidissamattos/bpcs/issues

# Icon credits

* Boxing gloves image by "surang" from  "flaticons.com"
* Hex Sticker created with the [hexSticker](https://github.com/GuangchuangYu/hexSticker) package

# References

